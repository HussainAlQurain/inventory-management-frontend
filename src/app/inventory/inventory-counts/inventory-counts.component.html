<div class="inventory-counts-container">
  <div class="page-header">
    <h1 class="page-title">Inventory Counts</h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="addNewCountSession()">
        <mat-icon>add</mat-icon> Add Count Session
      </button>
    </div>
  </div>

  <div class="filters-panel mat-elevation-z1">
    <div class="filter-section">
      <mat-form-field appearance="outline">
        <mat-label>Select Location</mat-label>
        <mat-select [(ngModel)]="selectedLocationId" (selectionChange)="onLocationChange()">
          <mat-option *ngFor="let location of locations" [value]="location.id">
            {{ location.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-section">
      <div class="date-range-container">
        <div class="date-presets">
          <button mat-button [matMenuTriggerFor]="dateRangeMenu">
            <span>{{ selectedDateRange || 'Select Date Range' }}</span>
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-menu #dateRangeMenu="matMenu">
            <button mat-menu-item *ngFor="let option of dateRangeOptions" 
                    (click)="applyDateRange(option)">
              {{ option.label }}
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item [disabled]="true" style="opacity: 0.6">Custom Range</button>
          </mat-menu>
        </div>

        <div class="custom-date-range">
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startDatePicker" [(ngModel)]="startDate">
            <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
          </mat-form-field>

          <span class="date-range-separator">to</span>

          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endDatePicker" [(ngModel)]="endDate">
            <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #endDatePicker></mat-datepicker>
          </mat-form-field>

          <button mat-raised-button color="primary" (click)="confirmCustomDateRange()">Apply</button>
          <button *ngIf="selectedDateRange" mat-button (click)="clearDateFilter()">Clear</button>
        </div>
      </div>
    </div>
  </div>

  <div class="table-container">
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
    
    <div *ngIf="loadingError" class="error-container">
      <p class="error-message">{{ loadingError }}</p>
      <button mat-raised-button color="primary" (click)="loadInventoryCounts()">Retry</button>
    </div>
    
    <div *ngIf="!isLoading && !loadingError && dataSource.data.length === 0" class="no-data-container">
      <p>No inventory count sessions found for the selected criteria.</p>
      <button mat-raised-button color="primary" (click)="addNewCountSession()">Create Your First Count Session</button>
    </div>
    
    <table *ngIf="!isLoading && !loadingError && dataSource.data.length > 0" 
           mat-table [dataSource]="dataSource" matSort class="inventory-counts-table">
      
      <!-- Count Date Column -->
      <ng-container matColumnDef="countDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Count Date</th>
        <td mat-cell *matCellDef="let session">{{ formatCountDate(session.countDate, session.dayPart) }}</td>
      </ng-container>

      <!-- Location Column -->
      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
        <td mat-cell *matCellDef="let session">{{ session.locationName }}</td>
      </ng-container>

      <!-- Value Column -->
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Value</th>
        <td mat-cell *matCellDef="let session">{{ session.valueOfCount | currency }}</td>
      </ng-container>

      <!-- Description Column -->
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef>Description</th>
        <td mat-cell *matCellDef="let session">{{ session.description }}</td>
      </ng-container>

      <!-- Locked Status Column -->
      <ng-container matColumnDef="locked">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Locked</th>
        <td mat-cell *matCellDef="let session">
          <mat-chip-option [selected]="session.locked" [disabled]="true" color="primary">
            {{ session.locked ? 'Yes' : 'No' }}
          </mat-chip-option>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let session">
          <button mat-icon-button color="primary" (click)="viewCountDetails(session)" matTooltip="View details">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" class="inventory-count-row"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
  </div>
</div>
